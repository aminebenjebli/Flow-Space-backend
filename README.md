<div align="center">

# Flow Space ‚Äì Backend API

Plateforme acad√©mique de productivit√© collaborative intelligente : gestion de t√¢ches augment√©e par l'IA, gamification, analytics, collaboration temps r√©el et support PWA.

![Status](https://img.shields.io/badge/status-active-success) ![Node](https://img.shields.io/badge/node-%3E=20.x-green) ![NestJS](https://img.shields.io/badge/nestjs-10.x-E0234E) ![Prisma](https://img.shields.io/badge/prisma-ORM-blue) ![DB](https://img.shields.io/badge/mongo-replica--set-critical) ![License](https://img.shields.io/badge/license-UNLICENSED-lightgrey)

</div>

---

## üß≠ Objectif du Projet

Fournir une base robuste et √©volutive pour exp√©rimenter des fonctionnalit√©s de productivit√© intelligente en √©quipe (priorisation IA, scoring, pr√©sence, analytics comportement, pr√©vention burnout). Ce d√©p√¥t est le backend unique (API REST + future WebSocket) ‚Äì orient√© apprentissage et qualit√© de code.

---

## ‚ú® Fonctionnalit√©s (Impl√©ment√©es & Planifi√©es)

### ‚úÖ Actuel

- Authentification JWT + OTP e-mail (activation + reset password)
- Gestion utilisateurs (CRUD, validation DTO, hash bcrypt)
- Upload fichiers (Multer, taille max configurable)
- Logging structur√© (Pino) + middleware de requ√™tes
- Rate limiting / throttling configurable
- Validation stricte des variables d'environnement
- Templates e-mail (Handlebars)
- Documentation Swagger `/api/docs`

### üöß En cours / √Ä venir

- Cr√©ation de t√¢ches en langage naturel
- Priorisation intelligente (mod√®le scoring hybride r√®gles + IA)
- Gamification (XP, niveaux, badges, leaderboards)
- Pr√©sence temps r√©el & collaboration (WebSocket + Redis)
- Analytics (heatmaps productivit√©, focus vs multit√¢che)
- D√©tection risque burnout (heuristiques horaires + charge)
- PWA: offline sync + notifications intelligentes

---

## ÔøΩÔ∏è Architecture & Stack

| Domaine          | Choix                                  |
| ---------------- | -------------------------------------- |
| Framework        | NestJS (architecture modulaire)        |
| Base de donn√©es  | MongoDB (Prisma Client) en replica set |
| Auth             | JWT + OTP + bcryptjs                   |
| Validation       | class-validator / class-transformer    |
| Logging          | nestjs-pino / pino-pretty (dev)        |
| Fichiers         | Multer (limite dynamique)              |
| Documentation    | Swagger (OpenAPI)                      |
| Tests            | Jest (unit + e2e)                      |
| S√©curit√©         | Helmet, throttler, validation DTO      |
| Conteneurisation | Docker / docker compose                |

---

## üìÇ Structure du Projet (r√©sum√©)

```
src/
    core/            # Config, services infra, utils
    modules/
        auth/          # Auth + OTP
        user/          # Users
        file-upload/   # Upload fichiers
    templates/       # E-mails Handlebars
prisma/
    schema.prisma    # Mod√®le Mongo (Prisma)
scripts/           # Scripts utilitaires
```

---

## üß™ Pr√©requis

| Outil              | Version recommand√©e           |
| ------------------ | ----------------------------- |
| Node.js            | ‚â• 20.x                        |
| npm                | ‚â• 10.x                        |
| MongoDB            | 6/7 (replica set obligatoire) |
| Docker (optionnel) | Latest                        |
| Redis (futur)      | Pour temps r√©el / cache       |

---

## üîß Variables d'Environnement (Validation)

Voir `.env.example`. Chaque variable est valid√©e au d√©marrage.

| Variable         | Description               | Exemple                                            |
| ---------------- | ------------------------- | -------------------------------------------------- |
| NODE_ENV         | Environnement             | development                                        |
| PORT             | Port HTTP                 | 8050                                               |
| BASE_URL         | URL publique API          | http://127.0.0.1:8050/                             |
| ALLOWED_ORIGINS  | CORS CSV                  | http://localhost:3000                              |
| THROTTLE_TTL     | Fen√™tre (s)               | 60                                                 |
| THROTTLE_LIMIT   | Requ√™tes / fen√™tre        | 100                                                |
| DATABASE_URL     | Connexion Mongo (rs)      | mongodb://localhost:27017/flowspace?replicaSet=rs0 |
| JWT_SECRET       | Secret JWT                | (string)                                           |
| EMAIL\_\*        | Config SMTP               | ...                                                |
| REDIS\_\*        | Config Redis (futur)      | ...                                                |
| LOG_LEVEL        | info / debug              | debug                                              |
| LOG_FORMAT       | pretty / json             | pretty                                             |
| MAX_FILE_SIZE    | Taille max upload (bytes) | 5242880                                            |
| UPLOAD_DIRECTORY | Dossier uploads           | uploads                                            |

---

## üöÄ D√©marrage (Choisir une Option)

### Option 1 ‚Äì Local MongoDB (Replica Set)

1. D√©marrer Mongo en replica set: `npm run db:start` (cross-platform)
2. `cp .env.example .env` puis adapter `DATABASE_URL`
3. `npm install`
4. `npx prisma generate && npx prisma db push`
5. `npm run start:dev`
6. Swagger: http://localhost:8050/api/docs

### Option 2 ‚Äì Docker

```
docker compose up -d
cp .env.example .env   # Ajuster DATABASE_URL si besoin
npx prisma generate
npx prisma db push
npm run start:dev
```

### Option 3 ‚Äì MongoDB Atlas (rapide)

1. Cr√©er cluster (free tier)
2. Ajouter IP locale / user
3. `DATABASE_URL="mongodb+srv://user:pass@cluster/flowspace"`
4. `npx prisma generate && npx prisma db push`

---

## üõ¢Ô∏è MongoDB Replica Set (Guide Complet)

Prisma requiert un replica set pour certaines op√©rations. Trois approches : Atlas, local, Docker.

### Atlas

```
DATABASE_URL="mongodb+srv://USER:PASSWORD@cluster0.xxxx.mongodb.net/flowspace"
npx prisma generate && npx prisma db push
```

### Local macOS / Linux

Terminal 1:

```bash
brew services stop mongodb-community || true
mkdir -p ./mongo-data/rs0
mongod --dbpath ./mongo-data/rs0 --replSet rs0 --port 27017 --bind_ip localhost
```

Terminal 2:

```bash
mongosh
rs.initiate({ _id: 'rs0', members: [{ _id: 0, host: 'localhost:27017' }] })
```

Env:

```env
DATABASE_URL="mongodb://localhost:27017/flowspace?replicaSet=rs0"
```

### Local Windows (PowerShell)

**Option 1 ‚Äì Script automatique (recommand√©):**

```powershell
# Utiliser le script fourni
npm run db:start:win
# OU directement
powershell -File ./scripts/start-mongodb.ps1
```

**Option 2 ‚Äì Batch (si PowerShell bloqu√©):**

```cmd
npm run db:start:win:bat
# OU directement
./scripts/start-mongodb.bat
```

**Option 3 ‚Äì Manuel:**

```powershell
New-Item -ItemType Directory -Force -Path .\mongo-data\rs0 | Out-Null
& "C:\\Program Files\\MongoDB\\Server\\7.0\\bin\\mongod.exe" --dbpath .\mongo-data\rs0 --replSet rs0 --port 27017 --bind_ip 127.0.0.1
```

Initialisation (terminal s√©par√©) :

```powershell
& "C:\\Program Files\\MongoDB\\Server\\7.0\\bin\\mongosh.exe"
rs.initiate({ _id: 'rs0', members: [{ _id: 0, host: 'localhost:27017' }] })
```

### Docker

```yaml
services:
    mongo:
        image: mongo:7
        command: ['mongod', '--replSet', 'rs0', '--bind_ip_all']
        ports:
            - '27017:27017'
        volumes:
            - ./mongo-data:/data/db
    mongo-init-replica:
        image: mongo:7
        depends_on:
            - mongo
        restart: 'no'
        entrypoint: >
            bash -c "sleep 5 && mongosh --host mongo:27017 --eval 'rs.initiate({_id:\"rs0\",members:[{_id:0,host:\"mongo:27017\"}]})' || true"
```

### V√©rification rapide

```bash
node -e "import('./node_modules/@prisma/client/index.js').then(async m=>{const p=new m.PrismaClient(); console.log(await p.user.count()); await p.$disconnect();})"
```

### D√©pannage

| Probl√®me              | Solution                                |
| --------------------- | --------------------------------------- |
| `needs replica set`   | V√©rifier `?replicaSet=rs0` dans l'URL   |
| Pas de PRIMARY        | Refaire `rs.initiate()` apr√®s restart   |
| Port occup√©           | `lsof -i :27017` puis kill PID          |
| Donn√©es cass√©es (dev) | `rm -rf ./mongo-data/rs0` puis relancer |

---

## üß™ Tests

```bash
npm run test       # Unitaires
npm run test:e2e   # End-to-end
npm run test:cov   # Couverture
npm run lint       # Qualit√© / ESLint
```

Seuil couverture cible: 80%.

---

## üîê S√©curit√© (actuel & futur)

| Domaine            | Impl√©ment√©  | √âvolution pr√©vue         |
| ------------------ | ----------- | ------------------------ |
| Auth JWT           | ‚úÖ          | Refresh tokens rotatifs  |
| OTP Email          | ‚úÖ          | Expiration configurable  |
| Rate limiting      | ‚úÖ          | Par IP + cl√© API (futur) |
| Validation DTO     | ‚úÖ          | Sch√©mas versionn√©s       |
| Headers Helmet     | ‚úÖ          | CSP stricte (futur)      |
| Logs structur√©s    | ‚úÖ          | Corr√©lation trace-id     |
| Hash mots de passe | ‚úÖ (bcrypt) | Argon2 benchmarking      |

---

## üß† Roadmap (Synth√®se Backend)

| Fonction            | Statut  | Commentaire                  |
| ------------------- | ------- | ---------------------------- |
| Auth + OTP          | Termin√© | Base stable                  |
| Upload fichiers     | Termin√© | Limites & types √† durcir     |
| IA Priorisation     | √Ä venir | Mod√®le scoring + pond√©ration |
| NLU cr√©ation t√¢ches | √Ä venir | Parsing prompt -> backlog    |
| Gamification        | √Ä venir | XP, badges, leaderboard      |
| Temps r√©el pr√©sence | √Ä venir | WS + Redis adapter           |
| Analytics heatmaps  | √Ä venir | Agr√©gations temporelles      |
| D√©tection burnout   | √Ä venir | Heuristiques + seuils        |
| PWA offline sync    | √Ä venir | File d'events & merge        |

---

## üß∞ Scripts (package.json)

## üß∞ Scripts (package.json)

```bash
# Development
npm run start:dev      # Dev + watch
npm run start:prod     # Lancement dist/
npm run build          # Compilation
npm run lint           # Lint + fix
npm run format         # Prettier

# Testing
npm run test / test:e2e / test:cov

# Database (Cross-platform)
npm run db:start       # D√©marrer Mongo replica (auto-d√©tecte OS)
npm run db:stop        # Arr√™ter MongoDB (auto-d√©tecte OS)
npm run db:push        # Prisma db push
npm run db:studio      # Prisma Studio
npm run db:check       # V√©rifier connexion DB
npm run db:generate    # G√©n√©rer Prisma Client

# Platform-specific (optionnel)
npm run db:start:mac   # macOS/Linux uniquement
npm run db:start:win   # Windows PowerShell
npm run db:start:win:bat # Windows Batch (si PowerShell bloqu√©)
npm run db:stop:mac    # macOS Homebrew
npm run db:stop:win    # Windows service
```

---

## üë• Flux de Contribution Interne

1. Cr√©er branche: `feat/xxx` ou `fix/xxx`
2. Ajouter/adapter tests (‚â•80%)
3. `npm run lint && npm run test`
4. Mettre √† jour README si changement majeur
5. PR avec description claire (contexte + solution)

Convention commit sugg√©r√©e (simplifi√©e) :

```
feat: ajout priorisation IA
fix: correction validation email
refactor: extraction service OTP
docs: mise √† jour guide Mongo
chore: bump d√©pendances
test: ajout cas OTP expir√©
```

---

## üßæ Licence

Usage acad√©mique interne. Ajouter une licence open-source si diffusion publique envisag√©e.

---

## üí¨ Support / Questions

Ouvrir une Issue (bug) ou Discussion (id√©e / conception). Pour d√©cisions techniques structurantes, cr√©er un mini ADR (`/docs/adr/XXXX-titre.md`).

---

Focus: clart√©, p√©dagogie, extensibilit√©. Chaque ajout doit : (1) √™tre test√©, (2) ne pas casser l‚Äôexistant, (3) respecter la coh√©rence architecture. üöÄ

## ‚ú® Fonctionnalit√©s Cl√©s

### ü§ñ Intelligence & Automatisation

- Cr√©ation de t√¢ches en langage naturel (ex: "Cr√©er un plan de lancement Q4 avec √©tapes et √©ch√©ances")
- Priorisation intelligente (score dynamique: urgence, impact, d√©pendances, charge)
- Suggestions contextuelles (regroupement, d√©coupage, assignation recommand√©e)
- D√©tection automatique d'inactivit√© / t√¢ches orphelines

### üïπÔ∏è Gamification Avanc√©e

- Syst√®me de points & niveaux (XP par compl√©tion pond√©r√©e)
- Badges, d√©fis d'√©quipe, qu√™tes collaboratives
- Leaderboards individuels et par √©quipe (filtrage p√©riode)
- Bonus streak & r√©duction de dette technique

### üë• Collaboration Temps R√©el

- Pr√©sence des membres (who is online / typing)
- Commentaires thread√©s + r√©actions
- Verrouillage optimiste & merge l√©ger sur t√¢ches
- Notifications in-app & email √©v√©nementielles

### üìä Analytics & Sant√© Organisationnelle

- Heatmaps de productivit√© (horaire / jour / √©quipe)
- D√©tection proactive de risque de burnout (charge + heures tardives)
- Tableau de bord focus vs multit√¢che
- KPI: velocity, lead time, throughput, flow efficiency

### üì± PWA & Exp√©rience Offline

- Synchronisation offline-first (file d'events + r√©solutions)
- Notifications intelligentes (regroupement & priorit√©)
- Cache adaptatif (t√¢ches actives + m√©tadonn√©es fr√©quentes)

### üîê S√©curit√© & Observabilit√©

- Authentification JWT + OTP e-mail (activation / r√©cup√©ration)
- Limitation de d√©bit (throttling configurable)
- Logs structur√©s (Pino) + corr√©lation requ√™tes
- Validation stricte environnement & inputs

## üèóÔ∏è Architecture Backend

| Domaine          | Impl√©mentation                      |
| ---------------- | ----------------------------------- |
| Framework        | NestJS (modules ind√©pendants)       |
| Base de donn√©es  | MongoDB via Prisma Client           |
| Auth             | JWT, OTP, hash bcryptjs             |
| Mail             | Nodemailer + Handlebars templates   |
| Logging          | nestjs-pino + pino-pretty en dev    |
| Validation       | class-validator / class-transformer |
| Documentation    | Swagger (route: `/api/docs`)        |
| Tests            | Jest (unit + e2e)                   |
| Conteneurisation | Docker + docker-compose             |
| Performance      | Compression, Helmet, Throttler      |

> Les modules IA (priorisation, NLU) & temps r√©el (WebSocket / Redis pub-sub) seront ajout√©s progressivement.

## üìÇ Structure du Projet

```
src/
   core/            # Infrastructure, config, utilitaires
   modules/
      auth/          # Authentification & OTP
      user/          # Gestion utilisateurs
      file-upload/   # Upload fichiers
   templates/       # Templates e-mail (Handlebars)
prisma/
   schema.prisma    # Mod√®le Prisma (MongoDB)
```

## üöÄ D√©marrage Rapide

```bash
git clone <repo-url> flow-space-backend
cd flow-space-backend
cp .env.example .env   # Configurer les variables
npm install
npx prisma generate
npx prisma db push
npm run start:dev
```

Swagger disponible sur: http://localhost:3000/api/docs

## üõ¢Ô∏è MongoDB (Replica Set) ‚Äì Guide Contributeurs

Prisma avec MongoDB exige un replica set (m√™me en local) pour certaines op√©rations (transactions internes). Trois options :

### 1. Option rapide (recommand√©e) : MongoDB Atlas

1. Cr√©er un cluster gratuit (Atlas).
2. R√©cup√©rer l‚ÄôURI.
3. Mettre √† jour `.env` :
   DATABASE_URL="mongodb+srv://USER:PASSWORD@cluster0.xxxx.mongodb.net/flowspace"
4. `npx prisma generate && npx prisma db push`

### 2.a Option locale manuelle (macOS / Linux)

Terminal 1 ‚Äì lancer `mongod` en replica set :

```bash
# Stop √©ventuel service brew (macOS Homebrew)
brew services stop mongodb-community || true

# Dossier data
mkdir -p ./mongo-data/rs0

# Lancer MongoDB (garde le terminal ouvert)
mongod --dbpath ./mongo-data/rs0 --replSet rs0 --port 27017 --bind_ip localhost
```

Terminal 2 ‚Äì initialiser le replica set :

```bash
mongosh
rs.initiate({
  _id: "rs0",
  members: [{ _id: 0, host: "localhost:27017" }]
})
rs.status()   # (optionnel) v√©rifier l‚Äô√©tat: PRIMARY attendu
```

Mettre √† jour `.env` :

```env
DATABASE_URL="mongodb://localhost:27017/flowspace?replicaSet=rs0"
```

Puis :

```bash
npx prisma generate
npx prisma db push
```

Test rapide :

```bash
node -e "import('./node_modules/@prisma/client/index.js').then(async m=>{const p=new m.PrismaClient(); console.log(await p.user.count()); await p.$disconnect();})"
```

### 2.b Option locale Windows (PowerShell / CMD)

Pr√©-requis : Installer MongoDB Community (ex: `C:\Program Files\MongoDB\Server\7.0\`). Ajouter le dossier `bin` au PATH ou utiliser le chemin complet.

PowerShell ‚Äì Terminal 1 :

```powershell
# Cr√©er le dossier data
New-Item -ItemType Directory -Force -Path .\mongo-data\rs0 | Out-Null

# Lancer mongod (laisser ouvert)
& "C:\Program Files\MongoDB\Server\7.0\bin\mongod.exe" --dbpath .\mongo-data\rs0 --replSet rs0 --port 27017 --bind_ip 127.0.0.1
```

PowerShell ‚Äì Terminal 2 (initialisation) :

```powershell
& "C:\Program Files\MongoDB\Server\7.0\bin\mongosh.exe"
rs.initiate({ _id: "rs0", members: [{ _id: 0, host: "localhost:27017" }] })
rs.status()
```

Mettre √† jour `.env` (identique) :

```env
DATABASE_URL="mongodb://localhost:27017/flowspace?replicaSet=rs0"
```

Synchronisation Prisma :

```powershell
npx prisma generate
npx prisma db push
```

Test rapide (PowerShell) :

```powershell
node -e "import('./node_modules/@prisma/client/index.js').then(m=>{const p=new m.PrismaClient(); p.user.count().then(c=>{console.log(c); p.$disconnect()})})"
```

Script helper Windows (optionnel) `scripts/mongo-replset.ps1` :

```powershell
Param(
  [string]$MongoBin = "C:\\Program Files\\MongoDB\\Server\\7.0\\bin"
)
New-Item -ItemType Directory -Force -Path .\mongo-data\rs0 | Out-Null
Write-Host "[mongo] starting (replica set rs0)..."
& "$MongoBin\\mongod.exe" --dbpath .\mongo-data\rs0 --replSet rs0 --port 27017 --bind_ip 127.0.0.1
```

Ex√©cution (si script bloqu√©) :

```powershell
Set-ExecutionPolicy -Scope CurrentUser RemoteSigned
./scripts/mongo-replset.ps1
```

### 3. Option Docker (int√©gr√©e)

Cr√©er (ou compl√©ter) `docker-compose.yml` :

```yaml
services:
    mongo:
        image: mongo:7
        command: ['mongod', '--replSet', 'rs0', '--bind_ip_all']
        ports:
            - '27017:27017'
        volumes:
            - ./mongo-data:/data/db

    mongo-init-replica:
        image: mongo:7
        depends_on:
            - mongo
        restart: 'no'
        entrypoint: >
            bash -c "sleep 5 &&
            mongosh --host mongo:27017 --eval
            'rs.initiate({_id:\"rs0\",members:[{_id:0,host:\"mongo:27017\"}]})' || true"
```

D√©marrer :

```bash
docker compose up -d
```

`.env` :

```env
DATABASE_URL="mongodb://localhost:27017/flowspace?replicaSet=rs0"
```

### 4. Script helper (optionnel)

Ajouter `scripts/mongo-replset.sh` :

```bash
#!/usr/bin/env bash
set -e
mkdir -p ./mongo-data/rs0
echo "[mongo] starting (replica set rs0)..."
mongod --dbpath ./mongo-data/rs0 --replSet rs0 --port 27017 --bind_ip localhost
```

Rendre ex√©cutable :

```bash
chmod +x scripts/mongo-replset.sh
```

### 5. R√©solution probl√®mes fr√©quents

| Probl√®me                              | Solution rapide                                |
| ------------------------------------- | ---------------------------------------------- |
| Erreur Prisma: needs replica set      | V√©rifier `?replicaSet=rs0` dans l‚ÄôURL          |
| `PRIMARY` absent dans `rs.status()`   | Relancer `mongod` puis refaire `rs.initiate()` |
| Port 27017 occup√©                     | `lsof -i :27017` puis tuer le process          |
| Donn√©es corrompues apr√®s arr√™t brutal | `rm -rf ./mongo-data && relancer` (en dev)     |

### 6. Flux standard pour un nouveau contributeur

```bash
git clone <repo>
cp .env.example .env              # Ajouter DATABASE_URL (voir ci-dessus)
# Choisir une des options (Atlas / local / Docker)
npm install
npx prisma generate
npx prisma db push
npm run start:dev
```

Une fois le serveur up: swagger => http://localhost:8050/api/docs

## üîß Variables d'Environnement (Validation Strict)

| Variable         | Description              | Exemple                         |
| ---------------- | ------------------------ | ------------------------------- |
| NODE_ENV         | Environnement            | development                     |
| PORT             | Port HTTP                | 3000                            |
| BASE_URL         | URL publique             | https://api.flow-space.dev      |
| ALLOWED_ORIGINS  | CORS liste (CSV)         | http://localhost:3000           |
| THROTTLE_TTL     | Fen√™tre (s)              | 60                              |
| THROTTLE_LIMIT   | Requ√™tes / fen√™tre       | 100                             |
| DATABASE_URL     | Connexion Mongo          | mongodb+srv://...               |
| JWT_SECRET       | Secret JWT               | (string)                        |
| EMAIL_HOST       | SMTP Host                | smtp.gmail.com                  |
| EMAIL_PORT       | SMTP Port                | 587                             |
| EMAIL_USER       | SMTP User                | bot@flow-space.dev              |
| EMAIL_PASSWORD   | SMTP Pass                | (secret)                        |
| EMAIL_FROM       | Exp√©diteur               | Flow Space <bot@flow-space.dev> |
| REDIS_HOST       | Host cache / events      | 127.0.0.1                       |
| REDIS_PORT       | Port Redis               | 6379                            |
| REDIS_PASSWORD   | Mot de passe (optionnel) | (secret)                        |
| LOG_LEVEL        | Niveau logs              | info                            |
| LOG_FORMAT       | Format (json/pretty)     | pretty                          |
| MAX_FILE_SIZE    | Upload max (bytes)       | 5242880                         |
| UPLOAD_DIRECTORY | Dossier fichiers         | ./uploads                       |

## üß† Roadmap Fonctionnelle (Backend)

| √âtape                | Statut | D√©tails                           |
| -------------------- | ------ | --------------------------------- |
| Auth de base + OTP   | ‚úÖ     | Activation + reset password       |
| Gestion utilisateurs | ‚úÖ     | CRUD + validation                 |
| Upload fichiers      | ‚úÖ     | Multer + limites                  |
| Priorisation IA      | üîú     | Mod√®le scoring + r√®gles hybrides  |
| Cr√©ation NL (NLU)    | üîú     | Parsing prompt -> t√¢ches          |
| Temps r√©el pr√©sence  | üîú     | WebSocket + Redis adapter         |
| Gamification moteur  | üîú     | Calcul XP + badges                |
| Analytics heatmaps   | üîú     | Agr√©gations temporelles           |
| Burnout detection    | üîú     | Heuristiques + signal charges     |
| PWA sync offline     | üîú     | File events + r√©solution conflits |

## üß™ Tests

```bash
npm run test          # Unitaires
npm run test:e2e      # End-to-end
npm run test:cov      # Couverture
npm run lint          # Qualit√© code
```

Seuil couverture global: 80% (branches, functions, lines, statements).

## üõ°Ô∏è S√©curit√©

- Headers s√©curis√©s (Helmet)
- Rate limiting / Throttler
- Validation des DTO stricte
- Hash mots de passe (bcryptjs)
- Tokens courts + refresh (√† impl√©menter)
- Logs structur√©s + tra√ßabilit√©

## üì¶ Docker

```bash
docker build -t flow-space-api .
docker compose up -d
```

## üß∞ Scripts Utiles

```bash
npm run start:dev      # Dev watch
npm run start:prod     # Prod (dist)
npm run build          # Compilation
npm run format         # Formatage Prettier
npm run security:audit # Audit d√©pendances
```

## üó∫Ô∏è Extension Futur (Id√©es)

- Int√©gration IA hybride (r√®gles + LLM) pour priorisation
- Module knowledge base contextuel
- Moteur recommandation √©quipe (charge / comp√©tences)
- Export analytics (CSV / Data Lake)
- Webhooks + int√©grations (Slack, Jira, GitHub)

## ü§ù Contribution

1. Fork
2. Branche feature: `feat/<nom>`
3. Tests + lint
4. PR avec description claire

## üìú Licence

UNLICENSED ‚Äì usage interne ou selon politique propri√©taire. Ajouter une licence si diffusion publique pr√©vue.

## üí¨ Support

Questions / id√©es : ouvrir une Issue ou d√©marrer une Discussion.

---

Focus sur la valeur et la clart√© : chaque module vise la robustesse, l'observabilit√© et l'extensibilit√©. üöÄ

## üö® Initial Setup

1. **Environment Setup**

    ```bash
    # Copy and configure environment variables
    cp .env.example .env
    ```

2. **Configure GitHub Repository Secrets**

    ```bash
    # Deployment Secrets
    PROD_HOST=
    PROD_SSH_USERNAME=
    PROD_SSH_PRIVATE_KEY=
    DEV_HOST=
    DEV_SSH_USERNAME=
    DEV_SSH_PRIVATE_KEY=

    # Environment Secrets
    TEST_ENV=           # Test environment variables
    DATABASE_URL=       # Production database URL

    # Integration Secrets
    SONAR_TOKEN=        # SonarCloud analysis token
    GITHUB_TOKEN=       # GitHub access token

    # Email Secrets (Optional)
    EMAIL_USER=
    EMAIL_PASSWORD=
    ```

3. **Database Setup**

    ```bash
    npx prisma generate
    npx prisma db push
    ```

4. **Start Development**
    ```bash
    npm install
    npm run start:dev
    ```

## üéØ Prerequisites

- Node.js (v22+)
- MongoDB (v4.4+)
- npm or yarn
- PM2 (for production)

## üöÄ Quick Start

```bash
# 1. Create from template
git clone https://github.com/yourusername/nestjs-template.git my-project
cd my-project

# 2. Install dependencies
npm install

# 3. Setup environment
cp .env.example .env

# 4. Start development server
npm run start:dev
```

## ‚ö°Ô∏è Template Features

- üèóÔ∏è Production-Ready Architecture
- üîê JWT Authentication & Authorization
- üìö Swagger API Documentation
- üóÑÔ∏è MongoDB with Prisma ORM
- ‚úÖ Comprehensive Testing Setup
- üîÑ CI/CD with GitHub Actions
- üìä Monitoring & Logging
- üõ°Ô∏è Security Best Practices
- üéØ Input Validation & Error Handling

## Technology Stack

- **Framework**: NestJS
- **Language**: TypeScript
- **Database**: MongoDB
- **Authentication**: JWT
- **Testing**: Jest
- **Documentation**: Swagger/OpenAPI

## Using This Template

1. **Create New Repository**

```bash
# Use this template from GitHub
Click "Use this template" button on GitHub
# OR clone and reinitialize
git clone https://github.com/yourusername/nestjs-template.git my-project
cd my-project
rm -rf .git
git init
```

2. **Update Project Configuration**

```bash
# Update package.json
- Change name, description, and author
- Update repository URLs

# Update environment variables
cp .env.example .env

# Update deployment configurations
- Edit deploy.sh with your app name
- Update .github/workflows/* with your deployment details
```

## Prisma & Schema Updates

Note: Prisma Migrate is not supported for MongoDB. Ensure you have a MongoDB instance running and the DATABASE_URL environment variable set in your .env file. Then, synchronize your Prisma schema with:

```bash
npx prisma db push
```

This command updates your MongoDB collections to match the Prisma schema. After pushing changes, update the Prisma Client with:

```bash
npx prisma generate
```

Ensure you have a backup of your MongoDB data before modifying the schema.

## API Documentation

API documentation is available at `/api/docs` when running the server.

## Project Structure

```
src/
‚îú‚îÄ‚îÄ app.module.ts
‚îú‚îÄ‚îÄ core
‚îÇ   ‚îú‚îÄ‚îÄ common
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ filters
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ guards
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ auth.guard.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ interceptors
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ middleware
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ logger.middleware.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ pipes
‚îÇ   ‚îú‚îÄ‚îÄ config
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ env.validation.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ swagger.config.ts
‚îÇ   ‚îú‚îÄ‚îÄ constants
‚îÇ   ‚îú‚îÄ‚îÄ exceptions
‚îÇ   ‚îú‚îÄ‚îÄ services
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ base.service.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ prisma.service.ts
‚îÇ   ‚îî‚îÄ‚îÄ utils
‚îÇ       ‚îú‚îÄ‚îÄ auth.ts
‚îÇ       ‚îú‚îÄ‚îÄ helpers.ts
‚îÇ       ‚îú‚îÄ‚îÄ logger.ts
‚îÇ       ‚îî‚îÄ‚îÄ validation.ts
‚îú‚îÄ‚îÄ main.ts
‚îú‚îÄ‚îÄ modules
‚îÇ   ‚îî‚îÄ‚îÄ user
‚îÇ       ‚îú‚îÄ‚îÄ dto
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ user.dto.ts
‚îÇ       ‚îú‚îÄ‚îÄ user.controller.spec.ts
‚îÇ       ‚îú‚îÄ‚îÄ user.controller.ts
‚îÇ       ‚îú‚îÄ‚îÄ user.module.ts
‚îÇ       ‚îú‚îÄ‚îÄ user.service.spec.ts
‚îÇ       ‚îî‚îÄ‚îÄ user.service.ts
‚îî‚îÄ‚îÄ templates
    ‚îú‚îÄ‚îÄ reset-password.hbs
    ‚îî‚îÄ‚îÄ verify-account.hbs
```

## Testing

```bash
# Unit tests - runs fast unit tests
npm run test

# Watch mode tests - continuously runs tests on file changes
npm run test:watch

# Debug tests - enables debug mode for troubleshooting test failures
npm run test:debug

# End-to-end tests - verifies API endpoints and integrations
npm run test:e2e

# Test coverage - generates comprehensive coverage reports
npm run test:cov

# Performance tests - simulates load using k6 performance testing
npm run test:performance

# Security audit - checks for vulnerabilities in project dependencies
npm run security:audit
```

## Testing Strategy

### Unit Tests

```bash
npm run test
```

- Tests individual components in isolation
- Located in `*.spec.ts` files next to the implementation
- Coverage threshold: 80% for all metrics

### Integration Tests

```bash
npm run test:e2e
```

- Tests API endpoints and service interactions
- Located in `test/` directory
- Includes database integration tests

### Performance Tests

```bash
npm run test:performance
```

- Uses k6 for load testing
- Tests API endpoints under load
- Measures response times and error rates
- Located in `tests/performance/`

### Security Tests

```bash
npm run security:audit
```

- npm audit for dependency vulnerabilities
- CodeQL analysis for code security
- Regular security patches

### Code Quality

```bash
npm run lint        # ESLint checks
npm run quality:sonar  # SonarCloud analysis
```

- Enforces coding standards
- Identifies code smells and bugs
- Maintains maintainability metrics

## Development Tools

### Available Scripts

```bash
npm run start:dev   # Development with hot reload
npm run start:debug # Debug mode
npm run start:prod  # Production mode
npm run build       # Production build
npm run format      # Format code with Prettier
```

### API Documentation

- Swagger UI: `/api/docs`

## Docker Support

```bash
# Build the container
docker build -t personal-template-nestjs-api .

# Run with Docker Compose
docker-compose up -d
```

## Monitoring & Logging

- Application metrics: Prometheus
- Logging: Winston
- Error tracking: Sentry

## Monitoring & Observability

### Logging

- Structured logging with Pino
- Log levels: error, warn, info, debug
- Request/Response logging middleware

### Health Checks

- Endpoint: `/health`
- Checks database connection
- Monitors external service dependencies

### Performance Monitoring

- Response time metrics
- Request rate tracking
- Error rate monitoring
- Resource usage stats

## Security Features

- JWT Authentication
- Rate limiting
- CORS protection
- Helmet security headers
- Input validation
- SQL injection protection
- XSS prevention

## Secrets Configuration

Ensure the following secrets are defined in your CI/CD environment (e.g., GitHub repository settings):

- PROD_HOST: Production server hostname or IP.
- PROD_SSH_USERNAME: SSH username for production deployments.
- PROD_SSH_PRIVATE_KEY: SSH private key for production deployments.
- DEV_HOST: Development server hostname or IP.
- DEV_SSH_USERNAME: SSH username for development deployments.
- DEV_SSH_PRIVATE_KEY: SSH private key for development deployments.
- SONAR_TOKEN: Token for SonarCloud analysis.
- TEST_ENV: Test environment variables.
- DATABASE_URL: Production database URL.

## Template Customization

### Module Structure

```
src/
‚îú‚îÄ‚îÄ modules/           # Feature modules
‚îÇ   ‚îú‚îÄ‚îÄ auth/         # Authentication module
‚îÇ   ‚îú‚îÄ‚îÄ user/         # User management
‚îÇ   ‚îî‚îÄ‚îÄ your-module/  # Add your modules here
```

### Adding New Features

```bash
# Generate new module
nest g module modules/your-module

# Generate CRUD resources
nest g resource modules/your-module
```

### 1. Application Name

- Update `package.json`
- Modify `deploy.sh`
- Update GitHub workflow files
- Change name in Swagger configuration

### 2. Environment Configuration

```bash
   # Copy and configure environment variables
   cp .env.example .env
```

### 3. Module Structure

The template follows a modular architecture:

```
src/
‚îú‚îÄ‚îÄ modules/           # Feature modules
‚îÇ   ‚îú‚îÄ‚îÄ auth/         # Authentication module
‚îÇ   ‚îú‚îÄ‚îÄ user/         # User management
‚îÇ   ‚îî‚îÄ‚îÄ your-module/  # Add your modules here
```

### 4. Adding New Modules

```bash
# Generate new module
nest g module modules/your-module

# Generate CRUD resources
nest g resource modules/your-module
```

### 5. Database Configuration

- Update `prisma/schema.prisma` with your models
- Run `npx prisma generate` after changes
- Modify `PrismaService` if needed

## Template Maintenance

### Updating Dependencies

```bash
# Check outdated packages
npm outdated

# Update packages
npm update

# Update major versions
npx npm-check-updates -u
```

### Contributing to Template

1. Fork the template repository
2. Create feature branch
3. Commit changes
4. Create Pull Request

## Support & Updates

- üì¶ Regular dependency updates
- üêõ Bug fixes via GitHub issues
- üí° Feature requests welcome
- üìñ Documentation improvements
